# name: CI/CD Pipeline cho Frontend UI

# on:
#   push:
#     branches: [main]
#   pull_request:
#     branches: [main]

# jobs:
#   deploy-frontend-only:
#     runs-on: ubuntu-latest
    
#     steps:
#       - uses: actions/checkout@v4

#       # 1. Setup Node.js (Cần để build Vite/React)
#       - name: Set up Node.js 20.x
#         uses: actions/setup-node@v4
#         with:
#           node-version: '20.x'
          
#       # 2. Build Frontend (Tạo thư mục 'dist')
#       - name: Build Frontend (Vite/React)
#         run: npm install && npm run build 

#       # 3. Khởi động Dịch vụ Frontend (Container)
#       - name: Start Frontend Service ONLY
#         # Lệnh này chỉ khởi động my-fe-app-service
#         run: docker compose up -d my-fe-app-service
        
#         # Trong file ci-cd.yml
#       - name: Upload Pages Artifact
#         uses: actions/upload-pages-artifact@v3
#         with:
#           path: './dist' # Phải là thư mục 'dist'
#       # 4. DEBUG: Kiểm tra trạng thái Container (RẤT QUAN TRỌNG ĐỂ TÌM LỖI)
#       - name: Check Container Status (Debug)
#         # Lệnh này liệt kê tất cả container, kể cả những container đã thoát (Exited)
#         run: docker ps -a
        
#       # 5. Kiểm tra Truy cập UI (HTTP 200 Check)
#       - name: Test Frontend Accessibility 
#         run: |
#           echo "Waiting 5 seconds for Nginx to start..."
#           sleep 5 
#           # Kiểm tra HTTP 200 OK trên cổng 3000
#           curl --fail http://localhost:3000 || (echo "Frontend UI failed to load" && exit 1)
#           echo "Frontend UI is successfully deployed and accessible."
          
#       # 6. Dọn dẹp
#       - name: Stop services
#         if: always()
#         run: docker compose down
name: Deploy Frontend UI to GitHub Pages

on:
  push:
    branches: [main]
  # Cho phép chạy thủ công từ tab Actions
  workflow_dispatch: 

jobs:
  # =======================================================
  # JOB 1: BUILD & UPLOAD (Tạo file tĩnh và tải lên GitHub)
  # =======================================================
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # 1. Setup Node.js 
      - name: Set up Node.js 20.x
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'

      # 2. Build Frontend (Tạo thư mục 'dist')
      - name: Install dependencies and Build
        run: npm install && npm run build 

      # 3. Upload Artifact (Tải thư mục 'dist' lên GitHub)
      - name: Upload Pages Artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './dist' 

  # =======================================================
  # JOB 2: DEPLOY (Triển khai Artifact lên URL Pages)
  # =======================================================
  deploy:
    environment:
      # Tên môi trường Pages (BẮT BUỘC)
      name: github-pages 
      url: ${{ steps.deployment.outputs.page_url }}
    
    runs-on: ubuntu-latest
    # Đảm bảo Job này chỉ chạy sau khi Build xong
    needs: build 
    
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        # Action này tự động lấy Artifact đã tải lên và triển khai
        uses: actions/deploy-pages@v4