name: CI/CD Pipeline cho Frontend UI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  deploy-frontend-only:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4

      # 1. Setup Node.js (Cần để build Vite/React)
      - name: Set up Node.js 20.x
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          
      # 2. Build Frontend (Tạo thư mục 'dist' chứa các file tĩnh)
      - name: Build Frontend (Vite/React)
        run: npm install && npm run build 

      # 3. Khởi động Dịch vụ Frontend (Container)
      - name: Start Frontend Service ONLY
        # Lệnh này chỉ khởi động my-fe-app-service, bỏ qua các dịch vụ BE
        run: docker compose up -d my-fe-app-service
        
      # 4. Kiểm tra Truy cập UI (Xác nhận giao diện đã "vào được")
      - name: Test Frontend Accessibility (HTTP 200 Check)
        run: |
          echo "Waiting 5 seconds for Nginx to start..."
          sleep 5 
          # Kiểm tra HTTP 200 OK trên cổng 3000
          curl --fail http://localhost:3000 || (echo "Frontend UI failed to load" && exit 1)
          echo "Frontend UI is successfully deployed and accessible."
          
      # 5. Dọn dẹp
      - name: Stop services
        if: always()
        run: docker compose down